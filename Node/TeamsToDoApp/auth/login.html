<html>
<html>
<head>
	<title>Login</title>
	<script src="https://statics.teams.microsoft.com/sdk/v0.4/js/MicrosoftTeams.min.js"></script>
	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
	<style type="text/css">
	</style>
</head>

<body>
<div class="ms-Grid">
	<div class="ms-Grid-row">
		<!-- App navigation bar markup. -->
		<div class="ms-NavBar">
			<ul class="ms-NavBar-items">
				<li class="navbar-header">Office 365 Connect sample</li>
			</ul>
		</div>
		
		<!-- App main content markup. -->
		<div class="ms-Grid-col ms-u-mdPush1 ms-u-md9 ms-u-lgPush1 ms-u-lg6">
			<div>
				<p class="ms-font-xl">Use the button below to connect to Office 365.</p>
				<button id="connect_button" class="ms-Button" onclick="login()">
					<span class="ms-Button-label">Connect to Office 365</span>
				</button>
			</div>
		</div>
	</div>
</div>
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
<script type="text/javascript">


function getURLParam(name) {
	var url = window.location.search.substring(1);
	var variables = url.split('&');
	for (var i = 0; i < variables.length; i++) {
		var variable = variables[i].split('=');
		if (variable[0] === name) {
			return decodeURIComponent(variable[1]);
		}
	}
}

var url;



function login() {
	 
	microsoftTeams.initialize();

    microsoftTeams.authentication.authenticate({
		url: url.replace(/&amp;/g, '&'),
		width: 600,
		height: 800,
		successCallback: () => {window.location = getURLParam('redirectUrl');},
		failureCallback: () => {}
	});
	//window.location = url.replace(/&amp;/g, '&');
}

console.log(getURLParam('redirectUrl'));

var host = 'https://fd5436aa.ngrok.io';
$.get(`${host}/auth/url?redirectUrl=`+encodeURIComponent(getURLParam('redirectUrl')), function (data) {
		url = data.url;
});

</script>
</body>

</html>