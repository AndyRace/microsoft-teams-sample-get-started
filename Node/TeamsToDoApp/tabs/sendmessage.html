<html>

<head>
	<title>Send message</title>
	<script src="https://statics.teams.microsoft.com/sdk/v0.4/js/MicrosoftTeams.min.js"></script>
	<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.2.1.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<style type="text/css">
		.team {
			cursor: pointer;
		}
	</style>
</head>

<body>
    <div id="teamheader" class="container">
		<h2 >Choose team:</h2>
		<div id="teams" class="container"></div>
	</div>
    <div id="channelheader" class="container">
		<h2>Choose channel:</h2>
		<div id="channels" class="container"></div>
	</div>
	<div id="sendmessageheader" class="container">
		<h2>Send message:</h2>
		<div id="sendmessages" class="container">
			<form>
				<div class="form-group">
				<label for="message">Comment:</label>
				<textarea class="form-control" rows="5" id="message"></textarea>
				</div>
				<button type="button" class="btn btn-default" id="sendmessagebutton">Send</button>
			</form>
		</div>
	</div>

	<script type="text/javascript">
		$('#channelheader').hide();	
		$('#sendmessageheader').hide();	
		var host = window.location.hostname;
		console.log(host);
		$.get(`https://${host}/graph/beta/me/joinedTeams`, function (groupData) {
			var html = `<ul class="list-group">`;
			for (var j = 0; j < groupData.value.length; j++) {					
				html += `<li class="list-group-item team" id="${groupData.value[j].id}">${groupData.value[j].displayName}</li>`
			}
			html += `</ul>`;
			$('#teams').html(html);
			$('.team').on('click', function () {
				$('.team').removeClass('active');
				$(this).addClass('active');
				var teamId = $(this).attr('id');
				$('#channelheader').show();
				$.get(`https://${host}/graph/beta/groups/${teamId}/channels`, function (channelData) {
					var html = `<ul class="list-group">`;
					for (var k = 0; k < channelData.value.length; k++) {					
						html += `<li class="list-group-item channel" id="${channelData.value[k].id}">${channelData.value[k].displayName}</li>`
					}
					html += `</ul>`;
					$('#channels').html(html);
					$('.channel').on('click', function () {
						$('.channel').removeClass('active');
						$(this).addClass('active');
						var channelId = $(this).attr('id');
						$('#sendmessageheader').show();
						$('#sendmessagebutton').on('click', function () {
							var message = $('#message').val();
							console.log(message);
							var data = {
									"rootMessage": {
										"body": {
											"contentType": 1,
											"content": message
										}
									}
								};
							console.log(JSON.stringify(data));
							$.ajax({
								type: "POST",
								url: `https://${host}/graph/beta/groups/${teamId}/channels/${channelId}/chatThreads`,
								data: JSON.stringify(data),                      
								contentType: "application/json",
								processData: false,
								dataType: "json",
								success: function (data, status) {}
							});
						});
					});
				});
			});
		});
	</script>
</body>

</html>